<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{fragments/layout}">

<head>
    <title>Lost/Found Item Detail</title>
</head>

<body>

    <!-- /* Content of this page will be decorated by the elements of layout.html (fragments/layout) */ -->
    <div layout:fragment="content" class="col">
        <h5 class="text-center p-2 m-3"
            th:text="${lostFoundItem.type.name()} == 'FOUND' ? 'Found Item Detail' : 'Lost Item Detail'">Item Detail
        </h5>
        <!--    <h3 class="text-center p-3 m-3" th:if="${lostFoundItem.type.name()} == 'LOST'">LOST Item Detail</h3>-->
        <div class="d-flex flex-column align-items-center justify-content-center mb-2">
            <div class="card px-4 w-50">
                <div class="card-body">

                    <h6 class="mt-2">Item Information</h6>
                    <div class="row py-2">
                        <div class="col-4">
                            Title
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.title}">Dell Laptop</span>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4">
                            Category
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.category}">Electronics</span>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4"
                            th:text="${lostFoundItem.type.name()} == 'FOUND' ? 'Found Date' : 'Lost Date'">
                            Date
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.lostFoundDate}">2022/01/21</span>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4"
                            th:text="${lostFoundItem.type.name()} == 'FOUND' ? 'Found Location' : 'Lost Location'">
                            Location
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.lostFoundLocation}">Hlaing Township</span>
                        </div>
                    </div>

                    <div class="row py-2"
                        th:if="${lostFoundItem.collectionLocation != null and !#strings.isEmpty(lostFoundItem.collectionLocation)}">
                        <div class="col-4">
                            Collection Location
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.collectionLocation}"></span>
                        </div>
                    </div>

                    <div class="row py-2" th:if="${lostFoundItem.latitude != null and lostFoundItem.longitude != null}">
                        <div class="col-12">
                            <div id="map"
                                style="height: 300px; width: 100%; border-radius: 5px; border: 1px solid #ced4da;">
                            </div>
                            <span id="itemLat" th:text="${lostFoundItem.latitude}" style="display:none;"></span>
                            <span id="itemLng" th:text="${lostFoundItem.longitude}" style="display:none;"></span>
                        </div>
                    </div>
                    <div class="row py-2">
                        <div class="col-4">
                            Created By
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.createdBy}">War War Aung</span>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4">
                            Modified By
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.modifiedBy}">War War Aung</span>
                        </div>
                    </div>

                    <div class="row py-2" th:if="${lostFoundItem.imageUrl != null}">
                        <div class="col-12 text-center">
                            <img th:src="@{${lostFoundItem.imageUrl}}" class="img-fluid" style="max-height: 300px;"
                                alt="Item Image" />
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4">
                            Detail Description
                        </div>
                        <div class="col-8">
                            <p th:text="${lostFoundItem.description}">Lorem ipsum dolor sit amet, consectetur
                                adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                                dolore magna aliqua.</p>
                        </div>
                    </div>

                    <h6>Contact Information</h6>
                    <div class="row py-2">
                        <div class="col-4">
                            Name
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.reporterName}">War War Aung</span>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4">
                            Phone Number
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.reporterPhoneNo}">09-123456789</span>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col-4">
                            E-mail
                        </div>
                        <div class="col-8">
                            <span th:text="${lostFoundItem.reporterEmail}">warwaraung@gmail.com</span>
                        </div>
                    </div>

                    <div class="row py-2 text-center">
                        <div class="col">
                            <a class="btn btn-success btn-sm w-100"
                                th:href="@{'/lostFound/edit/' + ${lostFoundItem.id}}" th:if="${#authorization.expression('hasAuthority(''UPDATE_ADMIN'')')} or
                                  ${#authentication?.principal?.id} == ${lostFoundItem.user.id}">Edit Report</a>
                        </div>
                    </div>
                </div>

                <hr />
                <h6 class="mt-2">Comments</h6>
                <div class="mb-3">
                    <div th:each="comment : ${lostFoundItem.comments}" class="card mb-2 bg-light">
                        <div class="card-body p-2">
                            <h6 class="card-subtitle mb-2 text-muted"
                                th:text="${comment.authorName} + ' - ' + ${#temporals.format(comment.createdAt, 'dd-MM-yyyy HH:mm')}">
                                Author</h6>
                            <p class="card-text" th:text="${comment.text}">Comment text</p>
                        </div>
                    </div>
                    <div th:if="${#lists.isEmpty(lostFoundItem.comments)}">
                        <p class="text-muted">No comments yet.</p>
                    </div>
                </div>

                <form th:action="@{'/lostFound/comment/' + ${lostFoundItem.id}}" method="post">
                    <div class="mb-3">
                        <label for="commentText" class="form-label">Add a Comment</label>
                        <textarea class="form-control" id="commentText" name="commentText" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">Post Comment</button>
                </form>
            </div> <!-- End of card -->
        </div>
    </div>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script th:if="${lostFoundItem.latitude != null and lostFoundItem.longitude != null}">
        document.addEventListener('DOMContentLoaded', function () {
            initMap();
        });

        function initMap() {
            const lat = parseFloat(document.getElementById('itemLat').innerText);
            const lng = parseFloat(document.getElementById('itemLng').innerText);

            // Initialize Leaflet Map
            const map = L.map('map').setView([lat, lng], 15);

            // Add OpenStreetMap Tile Layer
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

            // Add Marker
            L.marker([lat, lng]).addTo(map);
        }
    </script>
    </div>

</body>

</html>